@model Program

@{
    ViewData["Title"] = "Add News";
}

<h1>Add News</h1>

<h4>Program</h4>
<hr />
<div class="row">
    <div class="col-md-6">
        <form asp-action="add_news" method="post" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="form-group mb-3">
                <label for="Head_news" class="form-label">News Headline:</label>
                <input type="text" name="Head_news" class="form-control" required />
            </div>

            <div class="form-group mb-3">
                <label for="NewsHeadlinePics" class="form-label">Upload your Headline pictures:</label>
                <input type="file" id="NewsHeadlinePics" name="NewsHeadlinePics" class="form-control" accept=".jpg,.jpeg,.png">
                <div id="Headline-preview" class="mt-2 d-flex flex-wrap"></div>
            </div>

            <div class="form-group mb-3">
                <label for="comments" class="form-label">News Details:</label>
                <textarea name="comments" rows="10" class="form-control" placeholder="Enter detail of News..."></textarea>
            </div>

            <div class="form-group mb-3">
                <label for="otherPics" class="form-label">Upload your other pictures:</label>
                <input type="file" id="otherPics" name="otherPics" class="form-control" accept=".jpg,.jpeg,.png" multiple>
                <div id="otherPics-preview" class="mt-2 d-flex flex-wrap"></div>
            </div>

            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const headlineInput = document.getElementById('NewsHeadlinePics');
            const headlinePreviewContainer = document.getElementById('Headline-preview');

            headlineInput.addEventListener('change', function (event) {
                headlinePreviewContainer.innerHTML = ''; 
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        let img = document.createElement('img');
                        img.src = e.target.result;
                        img.classList.add('img-thumbnail', 'm-2');
                        img.style.maxHeight = '150px';
                        headlinePreviewContainer.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                }
            });

            
                 const otherPicsInput = document.getElementById('otherPics');
            const otherPicsPreviewContainer = document.getElementById('otherPics-preview');

            
            let fileStore = [];

            
            function updatePreviewsAndFileInput() {
                
                otherPicsPreviewContainer.innerHTML = '';
                const dataTransfer = new DataTransfer();
                fileStore.forEach((file, index) => {
                    
                    dataTransfer.items.add(file);
                    const previewWrapper = document.createElement('div');
                    previewWrapper.classList.add('position-relative', 'd-inline-block', 'm-2');
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const img = document.createElement('img');

                        img.src = e.target.result;

                        img.classList.add('img-thumbnail');

                        img.style.maxHeight = '150px';

                        previewWrapper.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                    const deleteBtn = document.createElement('button');

                    deleteBtn.innerHTML = '&times;'; 

                    deleteBtn.classList.add('btn', 'btn-danger', 'btn-sm', 'position-absolute', 'top-0', 'end-0');
                    
                    deleteBtn.style.cssText = 'line-height: 1; padding: 0.2rem 0.4rem; border-radius: 50%;';
                    
                    deleteBtn.onclick = function(event) {
                        event.preventDefault(); 
                        fileStore.splice(index, 1);
                        updatePreviewsAndFileInput();
                    };

                    previewWrapper.appendChild(deleteBtn);
                    otherPicsPreviewContainer.appendChild(previewWrapper);
                });

                otherPicsInput.files = dataTransfer.files;
            }

            otherPicsInput.addEventListener('change', function (event) {

                for (const file of event.target.files) {
                    fileStore.push(file);
                }


                updatePreviewsAndFileInput();

                
            });
        });
    </script>
}